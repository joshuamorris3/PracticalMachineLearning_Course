<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
	<meta charset="utf-8" />
	<meta content="IE=edge" http-equiv="X-UA-Compatible" />
	<meta content="en" http-equiv="Content-Language" />
	<title>PracticalMachineLearning_Course/index.rmd at master &middot; joshuamorris3/PracticalMachineLearning_Course</title>
	<link href="/opensearch.xml" rel="search" title="GitHub" type="application/opensearchdescription+xml" />
	<link href="https://github.com/fluidicon.png" rel="fluid-icon" title="GitHub" />
	<link href="/apple-touch-icon-114.png" rel="apple-touch-icon" sizes="57x57" />
	<link href="/apple-touch-icon-114.png" rel="apple-touch-icon" sizes="114x114" />
	<link href="/apple-touch-icon-144.png" rel="apple-touch-icon" sizes="72x72" />
	<link href="/apple-touch-icon-144.png" rel="apple-touch-icon" sizes="144x144" />
	<meta content="1401488693436528" property="fb:app_id" />
	<meta content="@github" name="twitter:site" />
	<meta content="summary" name="twitter:card" />
	<meta content="joshuamorris3/PracticalMachineLearning_Course" name="twitter:title" />
	<meta content="PracticalMachineLearning_Course - Coursera Practical Machine Learning course" name="twitter:description" />
	<meta content="https://avatars0.githubusercontent.com/u/5623830?v=3&amp;s=400" name="twitter:image:src" />
	<meta content="GitHub" property="og:site_name" />
	<meta content="object" property="og:type" />
	<meta content="https://avatars0.githubusercontent.com/u/5623830?v=3&amp;s=400" property="og:image" />
	<meta content="joshuamorris3/PracticalMachineLearning_Course" property="og:title" />
	<meta content="https://github.com/joshuamorris3/PracticalMachineLearning_Course" property="og:url" />
	<meta content="PracticalMachineLearning_Course - Coursera Practical Machine Learning course" property="og:description" />
	<meta content="https://api.github.com/_private/browser/stats" name="browser-stats-url" />
	<meta content="https://api.github.com/_private/browser/errors" name="browser-errors-url" />
	<link href="https://assets-cdn.github.com/" rel="assets" />
	<link href="wss://live.github.com/_sockets/NTYyMzgzMDo1NzE0MzlhYjZjYmZmOTEyYzg3YmY0NjgyN2FjZDIyNjowZGZjZDM0MmVkZDkzNTAyODk2MWU3YTEzZTkxNTU1YWI4MjA3NGE4ZDRjMGM3MmU3YTIxYTI1YmNlYzUwODcw--f7a66cf0a701b07da1e44c6d70241ed15f53eb0e" rel="web-socket" />
	<meta content="1000" name="pjax-timeout" />
	<link href="/sessions/sudo_modal" rel="sudo-modal" />
	<meta content="/windows-tile.png" name="msapplication-TileImage" />
	<meta content="#ffffff" name="msapplication-TileColor" />
	<meta data-pjax-transient="" name="selected-link" value="repo_source" />
	<meta content="UA-3769691-2" name="google-analytics" />
	<meta content="collector.githubapp.com" name="octolytics-host" />
	<meta content="collector-cdn.github.com" name="octolytics-script-host" />
	<meta content="github" name="octolytics-app-id" />
	<meta content="62CAC750:1FF6:C80D80B:553D3D97" name="octolytics-dimension-request_id" />
	<meta content="5623830" name="octolytics-actor-id" />
	<meta content="joshuamorris3" name="octolytics-actor-login" />
	<meta content="1c98a23b4dfb81c90c1e83e2ded016caeae53919afc60c39c96390ac80125d47" name="octolytics-actor-hash" />
	<meta content="Rails, view, blob#show" name="analytics-event" />
	<meta class="js-ga-set" content="Logged In" name="dimension1" />
	<meta class="js-ga-set" content="Header v3" name="dimension2" />
	<meta content="true" name="is-dotcom" />
	<meta content="github.com" name="hostname" />
	<meta content="joshuamorris3" name="user-login" />
	<link href="https://assets-cdn.github.com/favicon.ico" rel="icon" type="image/x-icon" />
	<meta content="authenticity_token" name="csrf-param" />
	<meta content="tO1i5RtY2zmxuZgKsymoGly7dwC1Jlr7cxE0Q+zrJZxDbmBZoSDSw7oBFJibbL+B0+wzTIPppcItIjOyRoy1lQ==" name="csrf-token" />
	<link href="https://assets-cdn.github.com/assets/github-99a212f30ce9bafd05712fa4c5c5de4e89c6c27396c34f6458dea3ea2a0b05b0.css" media="all" rel="stylesheet" />
	<link href="https://assets-cdn.github.com/assets/github2-b21c331cc5a9542882fc1f4e2cf08c371d7e52473ffc1017b2b64e3eccc953b8.css" media="all" rel="stylesheet" />
	<meta content="380e0b7c2b581631835a2841991e7107" http-equiv="x-pjax-version" />
	<meta content="PracticalMachineLearning_Course - Coursera Practical Machine Learning course" name="description" />
	<meta content="github.com/joshuamorris3/PracticalMachineLearning_Course git https://github.com/joshuamorris3/PracticalMachineLearning_Course.git" name="go-import" />
	<meta content="5623830" name="octolytics-dimension-user_id" />
	<meta content="joshuamorris3" name="octolytics-dimension-user_login" />
	<meta content="33911524" name="octolytics-dimension-repository_id" />
	<meta content="joshuamorris3/PracticalMachineLearning_Course" name="octolytics-dimension-repository_nwo" />
	<meta content="true" name="octolytics-dimension-repository_public" />
	<meta content="false" name="octolytics-dimension-repository_is_fork" />
	<meta content="33911524" name="octolytics-dimension-repository_network_root_id" />
	<meta content="joshuamorris3/PracticalMachineLearning_Course" name="octolytics-dimension-repository_network_root_nwo" />
	<link href="https://github.com/joshuamorris3/PracticalMachineLearning_Course/commits/master.atom" rel="alternate" title="Recent Commits to PracticalMachineLearning_Course:master" type="application/atom+xml" />
</head>
<body class="logged_in  env-production macintosh vis-public page-blob">
<p><a class="accessibility-aid js-skip-to-content" href="#start-of-content" tabindex="1">Skip to content</a></p>

<div class="wrapper">
<div class="site" itemscope="" itemtype="http://schema.org/WebPage">
<div class="container">
<div class="repository-with-sidebar repo-container new-discussion-timeline  ">
<div class="repository-content context-loader-container" data-pjax-container="" id="js-repo-pjax-container">
<div class="file">
<div class="blob instapaper_body" id="readme">
<article class="markdown-body entry-content" itemprop="mainContentOfPage">
<h1>Practical Machine Learning Course Project</h1>

<h2>Overview</h2>

<p>Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount of data about personal activity relatively inexpensively. One thing that people regularly do is quantify how much of a particular activity they do, but they rarely quantify how well they do it. In this project, we use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways. The goal of the project is to predict the manner in which they did the exercise.</p>

<p>The data for this project come from this source: <a href="http://groupware.les.inf.puc-rio.br/har">http://groupware.les.inf.puc-rio.br/har</a>.</p>

<h2>Approach</h2>

<p>Steps to create a model to predict the manner in which exercises are performed:</p>

<ol>
	<li>Load the training and test data</li>
	<li>Clean up both datasets</li>
	<li>Partition the training set into training and test data</li>
	<li>Set up the ability to use multiple CPU&rsquo;s to speed up the model creation step</li>
	<li>Train a model using random forest (explanation why random forest below)</li>
	<li>Apply against test data set created from the original training set (step 3)</li>
	<li>Estimate Out of Sample Error</li>
	<li>Apply the model against the original test data with unknown outcomes to determine the manner in which each exercise was performed</li>
	<li>Write the outcomes to a file for upload for assessment</li>
</ol>

<h2>R Environment Setup</h2>

<div class="highlight highlight-r">
<pre>
<div class="highlight highlight-r"><pre>install.packages(<span class="pl-s"><span class="pl-pds">"</span>caret<span class="pl-pds">"</span></span>,<span class="pl-v">dependencies</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)
install.packages(<span class="pl-s"><span class="pl-pds">"</span>randomForest<span class="pl-pds">"</span></span>,<span class="pl-v">dependencies</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)
install.packages(<span class="pl-s"><span class="pl-pds">"</span>doParallel<span class="pl-pds">"</span></span>,<span class="pl-v">dependencies</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)
library(<span class="pl-smi">caret</span>)
library(<span class="pl-smi">randomForest</span>)
library(<span class="pl-smi">doParallel</span>)</pre>
</div>

<h2>Loading and Cleaning the Datasets</h2>

<p>I downloaded the datasets manually from the Assignment Writeup page, then proceeded to load and clean the data:</p>

<h3>Load and initial clean</h3>

<p>Load both the training and testing data, cleaning up any NA, empty or divide by zero error strings using &lsquo;na.strings&rsquo; option of read.csv.</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-v">pmlTraining</span> <span class="pl-k">=</span> read.csv(<span class="pl-s"><span class="pl-pds">&quot;</span>../pml_course/pml-training.csv<span class="pl-pds">&quot;</span></span>, <span class="pl-v">na.strings</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">&quot;</span>NA<span class="pl-pds">&quot;</span></span>,<span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-pds">&quot;</span></span>,<span class="pl-s"><span class="pl-pds">&quot;</span>#DIV/0!<span class="pl-pds">&quot;</span></span>))
<span class="pl-v">pmlTesting</span> <span class="pl-k">=</span> read.csv(<span class="pl-s"><span class="pl-pds">&quot;</span>../pml_course/pml-testing.csv<span class="pl-pds">&quot;</span></span>, <span class="pl-v">na.strings</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">&quot;</span>NA<span class="pl-pds">&quot;</span></span>,<span class="pl-s"><span class="pl-pds">&quot;</span><span class="pl-pds">&quot;</span></span>,<span class="pl-s"><span class="pl-pds">&quot;</span>#DIV/0!<span class="pl-pds">&quot;</span></span>))</pre>
</div>

<p>This results in the following data sets:</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-k">&gt;</span> dim(<span class="pl-smi">pmlTraining</span>)
[<span class="pl-c1">1</span>] <span class="pl-c1">19622</span>   <span class="pl-c1">160</span>
<span class="pl-k">&gt;</span> dim(<span class="pl-smi">pmlTesting</span>)
[<span class="pl-c1">1</span>]  <span class="pl-c1">20</span> <span class="pl-c1">160</span></pre>
</div>

<h3>Remove NA and Unnecessary Data</h3>

<p>The next step is to remove data not useful to in our training step, this includes incomplete data, columns with NA&rsquo;s in this case, and columns we won&rsquo;t be using to train the data, in this case columns 1 through 7 i.e. columns named X, user_name, raw_timestamp_part_1, raw_timestamp_part_2, cvtd_timestamp, new_window, and num_window. We remove these as we need only focus in on the raw sensor data related to movement, and time related data is not important in this model since the movement, good or bad can happen at any time. Start with the training data</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-smi">training</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">pmlTraining</span>[,colSums(is.na(<span class="pl-smi">pmlTraining</span>)) <span class="pl-k">==</span> <span class="pl-c1">0</span>][,<span class="pl-k">-</span>c(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">7</span>)]</pre>
</div>

<p>Match and remove the same columns from the test data</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-smi">colUsed</span> <span class="pl-k">&lt;-</span> colnames(<span class="pl-smi">pmlTraining</span>[,colSums(is.na(<span class="pl-smi">pmlTraining</span>)) <span class="pl-k">==</span> <span class="pl-c1">0</span>])[<span class="pl-k">-</span>(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">7</span>)]
<span class="pl-smi">testingData</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">pmlTesting</span>[<span class="pl-smi">colUsed</span>[<span class="pl-smi">colUsed</span><span class="pl-k">!=</span><span class="pl-s"><span class="pl-pds">&#39;</span>classe<span class="pl-pds">&#39;</span></span>]]</pre>
</div>

<p>This results in the following data that has just the outcome variable (in the training set only) and potential predictors:</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-k">&gt;</span> dim(<span class="pl-smi">training</span>)
[<span class="pl-c1">1</span>] <span class="pl-c1">19622</span>    <span class="pl-c1">53</span>
<span class="pl-k">&gt;</span> dim(<span class="pl-smi">testingData</span>)
[<span class="pl-c1">1</span>] <span class="pl-c1">20</span> <span class="pl-c1">52</span> <span class="pl-c"># We have 52 because classe is not included, this is the outcome we are wanting to predict</span></pre>
</div>

<h2>Partition the training set into a training and test set</h2>

<p>We partition on the classe variable, and in the case use a 75/25 split for training/test data</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-smi">inTrain</span> <span class="pl-k">&lt;-</span> createDataPartition(<span class="pl-smi">training</span><span class="pl-k">$</span><span class="pl-smi">classe</span>,<span class="pl-v">p</span><span class="pl-k">=</span><span class="pl-c1">0.75</span>,<span class="pl-v">list</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)
<span class="pl-smi">trainData</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training</span>[<span class="pl-smi">inTrain</span>,]
<span class="pl-smi">testData</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training</span>[<span class="pl-k">-</span><span class="pl-smi">inTrain</span>,]</pre>
</div>

<p>This gives us the following data partitions:</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-k">&gt;</span> dim(<span class="pl-smi">trainData</span>)
[<span class="pl-c1">1</span>] <span class="pl-c1">14718</span>    <span class="pl-c1">53</span>
<span class="pl-k">&gt;</span> dim(<span class="pl-smi">testData</span>)
[<span class="pl-c1">1</span>] <span class="pl-c1">4904</span>   <span class="pl-c1">53</span></pre>
</div>

<h2>Set up parallel/multicore processing</h2>

<p>Although I ran this on an i7 2.00 GHz 8 core CPU with 16 GB RAM, I had memory allocation issues trying it with more than 4 cores allocated to the processing. Here are the settings I used:</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-smi">cl</span> <span class="pl-k">&lt;-</span> makeCluster(<span class="pl-c1">4</span>)
registerDoParallel(<span class="pl-smi">cl</span>)</pre>
</div>

<h2>Train model using Random Forest</h2>

<p>I&rsquo;m using the random forest method as it works well on a large number of variables (we have 52), and there is no need for applying principal component analysis (pca) to reduce the number of predictors, this is implicit in its method, it randomly finds the best fitting predictors. Random forest can lead to overfitting without cross validation. Here we use cross validation with resampling, to produce a low variance but still get good bias.</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-smi">modelFit</span> <span class="pl-k">&lt;-</span> train(<span class="pl-smi">classe</span> <span class="pl-k">~</span> .,<span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">trainData</span>,<span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>rf<span class="pl-pds">&quot;</span></span>,<span class="pl-v">trControl</span><span class="pl-k">=</span>trainControl(<span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>cv<span class="pl-pds">&quot;</span></span>,<span class="pl-v">number</span><span class="pl-k">=</span><span class="pl-c1">5</span>,<span class="pl-v">allowParallel</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>),<span class="pl-v">prox</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)</pre>
</div>

<p>This produces the model below. You can see that it used the 52 predictors, and found 5 factors in the classe variable, A,B,C,D and E. It also used resampling 5 times with cross-validation.</p>

<p>Interestingly enough the final mtry was 2 out of the 52 possible predictors. The plot below (the Model Fit figure) output shows this nicely, with the highest accuracy point being at 2 predictors. I did multiple runs on the training data, this being the last. I notice that sometimes it was not 2, but 27 predictors had the highest accuracy. This shows the variability/randomness in the model training (at least without a seed set).</p>

<p>Also the finalModel has 500 trees, although you can see from the plot below (the Final Model figure) that after about 100 trees the error doesn&rsquo;t change much across all classes.</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-k">&gt;</span> <span class="pl-smi">modelFit</span>
<span class="pl-smi">Random</span> <span class="pl-smi">Forest</span> 

<span class="pl-c1">14718</span> <span class="pl-smi">samples</span>
   <span class="pl-c1">52</span> <span class="pl-smi">predictors</span>
    <span class="pl-c1">5</span> <span class="pl-smi">classes</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&#39;</span>A<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>B<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>C<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>D<span class="pl-pds">&#39;</span></span>, <span class="pl-s"><span class="pl-pds">&#39;</span>E<span class="pl-pds">&#39;</span></span> 

<span class="pl-smi">No</span> <span class="pl-smi">pre</span><span class="pl-k">-</span><span class="pl-smi">processing</span>
<span class="pl-smi">Resampling</span><span class="pl-k">:</span> <span class="pl-smi">Cross</span><span class="pl-k">-</span>Validated (<span class="pl-c1">5</span> <span class="pl-smi">fold</span>) 

<span class="pl-smi">Summary</span> <span class="pl-smi">of</span> <span class="pl-smi">sample</span> <span class="pl-smi">sizes</span><span class="pl-k">:</span> <span class="pl-c1">11773</span>, <span class="pl-c1">11774</span>, <span class="pl-c1">11774</span>, <span class="pl-c1">11776</span>, <span class="pl-c1">11775</span> 

<span class="pl-smi">Resampling</span> <span class="pl-smi">results</span> <span class="pl-smi">across</span> <span class="pl-smi">tuning</span> <span class="pl-smi">parameters</span><span class="pl-k">:</span>

  <span class="pl-smi">mtry</span>  <span class="pl-smi">Accuracy</span>   <span class="pl-smi">Kappa</span>      <span class="pl-smi">Accuracy</span> <span class="pl-smi">SD</span>   <span class="pl-smi">Kappa</span> <span class="pl-smi">SD</span>   
   <span class="pl-c1">2</span>    <span class="pl-c1">0.9912352</span>  <span class="pl-c1">0.9889115</span>  <span class="pl-c1">0.0009117093</span>  <span class="pl-c1">0.001153311</span>
  <span class="pl-c1">27</span>    <span class="pl-c1">0.9910312</span>  <span class="pl-c1">0.9886546</span>  <span class="pl-c1">0.0013519706</span>  <span class="pl-c1">0.001709911</span>
  <span class="pl-c1">52</span>    <span class="pl-c1">0.9835563</span>  <span class="pl-c1">0.9791973</span>  <span class="pl-c1">0.0051781388</span>  <span class="pl-c1">0.006551089</span>

<span class="pl-smi">Accuracy</span> <span class="pl-smi">was</span> <span class="pl-smi">used</span> <span class="pl-smi">to</span> <span class="pl-smi">select</span> <span class="pl-smi">the</span> <span class="pl-smi">optimal</span> <span class="pl-smi">model</span> <span class="pl-smi">using</span>  <span class="pl-smi">the</span> <span class="pl-smi">largest</span> <span class="pl-smi">value</span>.
<span class="pl-smi">The</span> <span class="pl-smi">final</span> <span class="pl-smi">value</span> <span class="pl-smi">used</span> <span class="pl-k">for</span> <span class="pl-smi">the</span> <span class="pl-smi">model</span> <span class="pl-smi">was</span> <span class="pl-v">mtry</span> <span class="pl-k">=</span> <span class="pl-c1">2</span>.</pre>
</div>

<h3>ModelFit Figure</h3>

<p><a href="/joshuamorris3/PracticalMachineLearning_Course/blob/master/figs/modelFit.png" target="_blank"><img alt="Model Fit Figure" src="https://raw.githubusercontent.com/joshuamorris3/PracticalMachineLearning_Course/master/figs/modelFit.png" style="max-width:100%;" /></a></p>

<div class="highlight highlight-r">
<pre>
<span class="pl-k">&gt;</span> <span class="pl-smi">modelFit</span><span class="pl-k">$</span><span class="pl-smi">finalModel</span>

<span class="pl-smi">Call</span><span class="pl-k">:</span>
 randomForest(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-smi">x</span>, <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">y</span>, <span class="pl-v">mtry</span> <span class="pl-k">=</span> <span class="pl-smi">param</span><span class="pl-k">$</span><span class="pl-smi">mtry</span>, <span class="pl-v">proximity</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>) 
               <span class="pl-smi">Type</span> <span class="pl-smi">of</span> <span class="pl-smi">random</span> <span class="pl-smi">forest</span><span class="pl-k">:</span> <span class="pl-smi">classification</span>
                     <span class="pl-smi">Number</span> <span class="pl-smi">of</span> <span class="pl-smi">trees</span><span class="pl-k">:</span> <span class="pl-c1">500</span>
<span class="pl-smi">No</span>. <span class="pl-smi">of</span> <span class="pl-smi">variables</span> <span class="pl-smi">tried</span> <span class="pl-smi">at</span> <span class="pl-smi">each</span> <span class="pl-smi">split</span><span class="pl-k">:</span> <span class="pl-c1">2</span>

        <span class="pl-smi">OOB</span> <span class="pl-smi">estimate</span> <span class="pl-smi">of</span>  <span class="pl-smi">error</span> <span class="pl-smi">rate</span><span class="pl-k">:</span> <span class="pl-c1">0.69</span>%
<span class="pl-smi">Confusion</span> <span class="pl-smi">matrix</span><span class="pl-k">:</span>
     <span class="pl-smi">A</span>    <span class="pl-smi">B</span>    <span class="pl-smi">C</span>    <span class="pl-smi">D</span>    <span class="pl-smi">E</span>  <span class="pl-smi">class.error</span>
<span class="pl-smi">A</span> <span class="pl-c1">4182</span>    <span class="pl-c1">2</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>    <span class="pl-c1">1</span> <span class="pl-c1">0.0007168459</span>
<span class="pl-smi">B</span>   <span class="pl-c1">19</span> <span class="pl-c1">2822</span>    <span class="pl-c1">7</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span> <span class="pl-c1">0.0091292135</span>
<span class="pl-smi">C</span>    <span class="pl-c1">0</span>   <span class="pl-c1">17</span> <span class="pl-c1">2548</span>    <span class="pl-c1">2</span>    <span class="pl-c1">0</span> <span class="pl-c1">0.0074016362</span>
<span class="pl-smi">D</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>   <span class="pl-c1">41</span> <span class="pl-c1">2368</span>    <span class="pl-c1">3</span> <span class="pl-c1">0.0182421227</span>
<span class="pl-smi">E</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>    <span class="pl-c1">2</span>    <span class="pl-c1">7</span> <span class="pl-c1">2697</span> <span class="pl-c1">0.0033259424</span></pre>
</div>

<h3>Final Model Figure</h3>

<p><a href="/joshuamorris3/PracticalMachineLearning_Course/blob/master/figs/modelFitFinalModel.png" target="_blank"><img alt="Final Model Figure" src="https://raw.githubusercontent.com/joshuamorris3/PracticalMachineLearning_Course/master/figs/modelFitFinalModel.png" style="max-width:100%;" /></a></p>

<h2>Apply model to the original training set test data (step 3)</h2>

<p>Applying this to our created test set (not the given test set), we can see how well our model performs. Below from the confusionMatrix you can see that we estimate a high level of accuracy, 99.55%.</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-smi">testPred</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">modelFit</span>,<span class="pl-v">newdata</span><span class="pl-k">=</span><span class="pl-smi">testData</span>)

<span class="pl-k">&gt;</span> confusionMatrix(<span class="pl-smi">testPred</span>,<span class="pl-smi">testData</span><span class="pl-k">$</span><span class="pl-smi">classe</span>)
<span class="pl-smi">Confusion</span> <span class="pl-smi">Matrix</span> <span class="pl-smi">and</span> <span class="pl-smi">Statistics</span>

          <span class="pl-smi">Reference</span>
<span class="pl-smi">Prediction</span>    <span class="pl-smi">A</span>    <span class="pl-smi">B</span>    <span class="pl-smi">C</span>    <span class="pl-smi">D</span>    <span class="pl-smi">E</span>
         <span class="pl-smi">A</span> <span class="pl-c1">1392</span>    <span class="pl-c1">3</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>
         <span class="pl-smi">B</span>    <span class="pl-c1">1</span>  <span class="pl-c1">946</span>    <span class="pl-c1">8</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>
         <span class="pl-smi">C</span>    <span class="pl-c1">2</span>    <span class="pl-c1">0</span>  <span class="pl-c1">847</span>    <span class="pl-c1">7</span>    <span class="pl-c1">0</span>
         <span class="pl-smi">D</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>  <span class="pl-c1">797</span>    <span class="pl-c1">1</span>
         <span class="pl-smi">E</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>    <span class="pl-c1">0</span>  <span class="pl-c1">900</span>

<span class="pl-smi">Overall</span> <span class="pl-smi">Statistics</span>

               <span class="pl-smi">Accuracy</span> <span class="pl-k">:</span> <span class="pl-c1">0.9955</span>          
                 <span class="pl-c1">95</span>% <span class="pl-smi">CI</span> <span class="pl-k">:</span> (<span class="pl-c1">0.9932</span>, <span class="pl-c1">0.9972</span>)
    <span class="pl-smi">No</span> <span class="pl-smi">Information</span> <span class="pl-smi">Rate</span> <span class="pl-k">:</span> <span class="pl-c1">0.2845</span>          
    <span class="pl-smi">P</span><span class="pl-k">-</span><span class="pl-smi">Value</span> [<span class="pl-smi">Acc</span> <span class="pl-k">&gt;</span> <span class="pl-smi">NIR</span>] <span class="pl-k">:</span> <span class="pl-k">&lt;</span> <span class="pl-c1">2.2e-16</span>       

                  <span class="pl-smi">Kappa</span> <span class="pl-k">:</span> <span class="pl-c1">0.9943</span>          
 <span class="pl-smi">Mcnemar</span><span class="pl-s"><span class="pl-pds">&#39;</span>s Test P-Value : NA              </span>

<span class="pl-s">Statistics by Class:</span>

<span class="pl-s">                     Class: A Class: B Class: C Class: D Class: E</span>
<span class="pl-s">Sensitivity            0.9978   0.9968   0.9906   0.9913   0.9989</span>
<span class="pl-s">Specificity            0.9991   0.9977   0.9978   0.9998   1.0000</span>
<span class="pl-s">Pos Pred Value         0.9978   0.9906   0.9895   0.9987   1.0000</span>
<span class="pl-s">Neg Pred Value         0.9991   0.9992   0.9980   0.9983   0.9998</span>
<span class="pl-s">Prevalence             0.2845   0.1935   0.1743   0.1639   0.1837</span>
<span class="pl-s">Detection Rate         0.2838   0.1929   0.1727   0.1625   0.1835</span>
<span class="pl-s">Detection Prevalence   0.2845   0.1947   0.1746   0.1627   0.1835</span>
<span class="pl-s">Balanced Accuracy      0.9985   0.9973   0.9942   0.9955   0.9994</span></pre>
</div>

<h2>Estimate Out of Sample Error</h2>

<p>To verify what the confusionMatrix output is telling us about the estimated accuracy and out of sample error, we calculate the accuracy ourselves, (correct answers/number of rows), then invert that to get the estimate of the Out of Sample Error.</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-k">&gt;</span> (<span class="pl-c1">1</span> <span class="pl-k">-</span> sum(<span class="pl-smi">testPred</span> <span class="pl-k">==</span> <span class="pl-smi">testData</span><span class="pl-k">$</span><span class="pl-smi">classe</span>)<span class="pl-k">/</span>length(<span class="pl-smi">testPred</span>)) <span class="pl-k">*</span> <span class="pl-c1">100</span>
[<span class="pl-c1">1</span>] <span class="pl-c1">0.4486134</span></pre>
</div>

<p>So the estimated Out of Sample Error for the above model is:</p>

<p>0.45%</p>

<p>which coincides with what the confusionMatrix is telling us i.e. (1 - 0.9955) * 100 = 0.45%</p>

<h2>Apply model to test data to determine outcomes</h2>

<p>Now we can apply our model to the given test data, the data we want to determine outcomes for.</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-smi">answers</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">modelFit</span>,<span class="pl-v">newdata</span><span class="pl-k">=</span><span class="pl-smi">testingData</span>)</pre>
</div>

<p>This gives us a list of outcomes for each of the 20 test rows with one value for each test row that is one of A,B,C,D or E.</p>

<h2>Write the outcomes to a file for upload and assessment</h2>

<p>To upload the answers to be assessed, I&rsquo;m using the code given on the Coursera website:</p>

<div class="highlight highlight-r">
<pre>
<span class="pl-v">pml_write_files</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>){
  <span class="pl-v">n</span> <span class="pl-k">=</span> length(<span class="pl-smi">x</span>)
  <span class="pl-k">for</span>(<span class="pl-smi">i</span> <span class="pl-k">in</span> <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-smi">n</span>){
    <span class="pl-v">filename</span> <span class="pl-k">=</span> paste0(<span class="pl-s"><span class="pl-pds">&quot;</span>problem_id_<span class="pl-pds">&quot;</span></span>,<span class="pl-smi">i</span>,<span class="pl-s"><span class="pl-pds">&quot;</span>.txt<span class="pl-pds">&quot;</span></span>)
    write.table(<span class="pl-smi">x</span>[<span class="pl-smi">i</span>],<span class="pl-v">file</span><span class="pl-k">=</span><span class="pl-smi">filename</span>,<span class="pl-v">quote</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>,<span class="pl-v">row.names</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>,<span class="pl-v">col.names</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)
  }
}

pml_write_files(<span class="pl-smi">answers</span>)</pre>
</div>

<p>This produces 20 files called problem_id_1.txt through problem_id_20.txt, each with one of A,B,C,D or E in them.</p>
</article>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
